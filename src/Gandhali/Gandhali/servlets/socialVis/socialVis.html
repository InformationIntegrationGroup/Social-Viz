<html>
<head>
<link rel="stylesheet" href="style.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script type="text/javascript" src="lib/d3.v3.min.js"></script>
<script type="text/javascript" src="map.js"></script>
<script type="text/javascript" src="lib/topojson.v0.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script type="text/javascript">
//var mapInstance = new WorldMap();

function executeQuery(){
	var value = document.getElementById("category").value;
	var stDate = document.getElementById("startDate").value;
	var edDate = document.getElementById("endDate").value;
	var url = "http://localhost:8080/Gandhali/queryServlet?category="+value+"&stDate="+stDate+"&edDate="+edDate;
   var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4) {
			
            var data = xhr.responseText;
            //alert(data);
			doc = eval('(' + xhr.responseText + ')');
			var mapInstance = new WorldMap();
			mapInstance.generateMap(doc);
			var counter=0;
			document.getElementById('pause').value='Pause';
			
			$('#pause').unbind('click').click( function() { 
				//var timerId = mapInstance.timer();
				
				var elem = document.getElementById('pause');
				if(elem.value=='Pause'){
					elem.value='Resume';
					counter = mapInstance.pause(); 
				//	alert(counter);
				}
				else{
					elem.value='Pause';
					mapInstance.start(counter);
				}
			});
        }
    }
    xhr.open('GET', url, true);
    xhr.send(null);
}
</script>
</head>

<body>

<div id="mainContainer">
</div>

<script type="text/javascript" src="map.js"></script>

<script type="text/javascript">
//executeQuery();
</script>
<div id = "queryForm" class="hidden">
	<form>
		<p id="title" style="height: 20px"></p>
		<p>Start date: <input type="text" id="startDate" placeholder="2014-07-01" ></p>
		<p>End date: <input type="text" id="endDate" placeholder= "2014-07-20" ></p>
		<p>Category: <select id="category">
			<option value="" disabled selected>Select your option</option>
		  	<option value="age">Age</option>
		  	<option value="ethnicity">Ethnicity</option>
		  	<option value="eyecolor">Eye Color</option>
		  	<option value="haircolor">Hair Color</option>
		</select></p>
		<p>Delay:<input type="text" id="delay" placeholder="in milliseconds"></p>
		<input type="button" value = "Filter" onclick="executeQuery()" />
	</form>
	<input type="button" id="pause" value="Pause" />
</div>
</body>
</html>


