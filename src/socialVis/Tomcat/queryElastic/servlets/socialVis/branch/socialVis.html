<html>
<head>
<link rel="stylesheet" href="style.css" />
<script type="text/javascript" src="lib/jquery.js"></script>
<script type="text/javascript" src="lib/d3.js" charset="utf-8"></script>
<script type="text/javascript" src="socialVis-v1.js"></script>
<script type="text/javascript" src="lib/topojson.v1.min.js"></script>
<script type="text/javascript" src="mapTest1.js"></script>

</head>

<body> 


<script type="text/javascript">	
	var req = false;
	var socialVisInstance = new SocialVis();
	// socialVisInstance.generateSocialVis("testElastic/eclipseOutput.json");

	//excute when search button in the form is clicked
	function executeQuery(){
		var stDate = document.getElementById("startDate").value;
		var edDate = document.getElementById("endDate").value;
		var phoneNumbers = document.getElementById("pNumbers").value;
		var maxNode = document.getElementById("maxNode").value;
		var transitionGap = document.getElementById("transitionGapText").value;
		if (transitionGap == "")
			transitionGap = 1500;
		setTransitionGapInvoker(transitionGap);
		console.log(stDate + "\n" + edDate + "\n" + phoneNumbers + "\n" + maxNode + "\n" + transitionGap);
		var url = "http://localhost:8080/queryElastic/queryServlet?" + "stDate="+ stDate + "&edDate=" + edDate + "&phoneNum=" + phoneNumbers + "&maxNode=" + maxNode;
		console.log(url)
		req = new XMLHttpRequest();
		req.onreadystatechange = mycallback;
		req.open("GET", url, true);
		req.send(null);
	}

	//call back function of AJAX
	function mycallback(){	
		if (req.readyState == 4) {
			//console.log(req.status);
			if (req.status == 200) {			
				// console.log(req.responseText)
				doc = eval('(' + req.responseText + ')');	
				console.log(doc);	
				socialVisInstance.generateSocialVisFromServlet(doc);			
			}
		} 
	}

	//reset transition
	function resetTransitionInvoker(){
		socialVisInstance.resetTransition();
	}

	//useless
	//invoke functio nof socialVis to show the chosen node's history path
	function showNodePathInvoker(){
		var parameter = $("#nodePathText").val();
		console.log("Start show node path");
		socialVisInstance.showNodePath(parameter);
	}

	//useless
	//quit the highlight node path
	function quitShowPathInvoker(){
		console.log("Quit show path");
		socialVisInstance.quitShowPath();
	}

	//stop the transition process
	function stopTransitionInvoker(){
		socialVisInstance.stopTransition();
	}

	//resume the transition process
	function resumeTransitionInvoker(){
		socialVisInstance.resumeTransition();
	}

	//jump transition to the day user choose
	function jumpTransitionInvoker(){
		var parameter = $("#chooseTransitionText").val();
		socialVisInstance.jumpTransition(parameter);
	}

	//set the time gap of each transition
	function setTransitionGapInvoker(value){
		var val = parseInt(value);
		if (val == NaN || val < 100 || val > 5000){
			alert("Invalid transition gap. Set it to 2000.")
			socialVisInstance.setTransitionGap(1500);
		} else
			socialVisInstance.setTransitionGap(val);
	}

	//set the appearance of node's moving path
	function setShowNodePathInvoker(){
		var val = document.getElementById("showNodePathCheck").checked;
		console.log("clicked checkbox of showNodePath: " + val)
		socialVisInstance.setShowNodePathAPI(val);
	}



</script>



<div id="mainContainer">

<div id = "leftPanel">
	<div id = "dateText">
		&nbsp;
	</div>
	<br>

	<div id = "queryForm">
		<table>
			<tr><td>Start date: </td><td><input type="text" id="startDate" placeholder="2014-07-01" ></td></tr>
			<tr><td>End date: </td><td><input type="text" id="endDate" placeholder="2014-07-20" ></td></tr>
			<tr><td>Numbers: </td><td><input type = "text" id = "pNumbers" placeholder = "Numbers split by /" ></td></tr>
			<tr><td>Max node: </td><td><input type = "text", id = "maxNode" placeholder = "number of shown node"></td></tr>
			<tr><td>Transition gap: </td><td><input type = "text", id = "transitionGapText" placeholder = "default: 1500"></td></tr>
		</table>
		<input type="button" value = "Search" onclick="executeQuery()">
	</div>
	<br>


	<input type="checkbox" id="showNodePathCheck" checked onclick="setShowNodePathInvoker()">NodePath<br>

	<div id = "chooseTransitionDayForm">
		<table>
			<tr>
				<td><input type="text" id="chooseTransitionText" placeholder="transition No." ></td>
				<td><input type="button" value = "Jump" onclick="jumpTransitionInvoker()"></td>
			</tr>
		</table>
	</div>
	<br>

	<div id = "pauseTransitionForm">
		<table>
			<tr><td><input type="button" value = "Stop" onclick="stopTransitionInvoker()"></td><td><input type="button" value = "Resume" onclick="resumeTransitionInvoker()"></td></tr>
		</table>
	</div>
	<br>
	
	<hr>
	<br>

	<div id = "nodeHistory">
	</div>

</div>

<div id = "rightPanel">
</div>

</div>


<div id = "nodeToolTip" class="hidden">
</div>

<div id = "clusterToolTip" class="hidden">
</div>

</body>
</html>


